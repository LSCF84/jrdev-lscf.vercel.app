<script src="https://cdn.tailwindcss.com"></script>
<script>
    // ------------------------------------------------------------------
    // 1. CONFIGURACIÓN INICIAL DE COLORES Y TAILWIND
    // ------------------------------------------------------------------
    
    // Paletas disponibles (nombre, color principal, color oscuro de hover)
    const COLOR_PALETTES = {
        cyan: { primary: '#00FFFF', dark: '#00D5D5' },
        blue: { primary: '#3B82F6', dark: '#2563EB' },
        pink: { primary: '#EC4899', dark: '#DB2777' },
        lime: { primary: '#84CC16', dark: '#65A30D' },
        red: { primary: '#EF4444', dark: '#DC2626' }
    };

    // Color por defecto (se cargará desde localStorage si existe)
    let primaryColor = COLOR_PALETTES.cyan.primary; 
    let darkColor = COLOR_PALETTES.cyan.dark;
    
    // Configuración de Tailwind para usar la variable CSS --color-primary
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    'primary-dynamic': 'var(--color-primary)', // Color principal dinámico
                    'primary-dark-dynamic': 'var(--color-primary-dark)', // Color de hover dinámico
                    'secondary': '#343A40', 
                    'accent': '#0D6EFD', // Azul fijo para el botón de recarga
                    'form-bg': '#282A2E', 
                    'page-bg': '#1E2124', 
                },
            },
        },
    }
</script>

<style>
    /* Estilos generales para Inter y centrado */
    body {
        font-family: 'Inter', sans-serif;
        background-color: #1E2124; /* Fondo oscuro fijo */
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
        /* Definición inicial de las variables CSS */
        --color-primary: #00FFFF; 
        --color-primary-dark: #00D5D5;
    }
    .form-container {
        max-width: 550px;
        width: 100%;
        background-color: #282A2E; 
        position: relative; /* Necesario para posicionar el selector */
    }

    /* Estilos dinámicos usando las variables CSS */
    .bg-primary-dynamic { background-color: var(--color-primary) !important; }
    .hover\:bg-primary-dark-dynamic:hover { background-color: var(--color-primary-dark) !important; } 
    .focus\:ring-primary-dynamic:focus { --tw-ring-color: var(--color-primary) !important; }
    .focus\:border-primary-dynamic:focus { border-color: var(--color-primary) !important; }
    .text-primary-dynamic { color: var(--color-primary) !important; }
    .hover\:text-primary-dark-dynamic:hover { color: var(--color-primary-dark) !important; }
    .border-primary-dynamic { border-color: var(--color-primary) !important; }

    /* Estilos del selector de color */
    .color-picker {
        position: absolute;
        top: 20px;
        right: 20px;
        display: flex;
        gap: 8px;
    }
    .color-circle {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        cursor: pointer;
        transition: transform 0.1s;
        border: 2px solid transparent;
        box-shadow: 0 0 5px rgba(0,0,0,0.5);
    }
    .color-circle:hover {
        transform: scale(1.1);
    }
    .color-circle.selected {
        border-color: #FFFFFF; /* Borde blanco para el color seleccionado */
        box-shadow: 0 0 10px var(--color-primary); /* Brillo del color seleccionado */
    }

    /* Clases para la transición de la alerta de error */
    .alert-transition { transition: all 0.3s ease-in-out; }
    .alert-closed { opacity: 0; height: 0; margin-bottom: 0 !important; }
    .alert-open { opacity: 100; height: auto; margin-bottom: 1.5rem; }
</style>

<div class="form-container rounded-xl shadow-2xl p-6 md:p-10">
    
    <!-- --------------------------------------- -->
    <!-- 1. Selector de Paleta de Colores -->
    <!-- --------------------------------------- -->
    <div id="colorPicker" class="color-picker" title="Seleccionar color de acento">
        <!-- Los círculos se inyectan aquí con JavaScript -->
    </div>
    
    <!-- --------------------------------------- -->
    <!-- 2. Formulario de Contacto (Visible por defecto) -->
    <!-- --------------------------------------- -->
    <div id="contactFormContainer">
        <h1 class="text-3xl font-bold text-white mb-2">¡Empecemos a trabajar juntos!</h1>
        <p class="text-gray-400 mb-8">Rellena este breve formulario y me pondré en contacto contigo lo antes posible.</p>

        <!-- action="javascript:return false;" previene la navegación por defecto -->
        <form id="contactForm" action="javascript:return false;" method="POST" class="space-y-6">

            <!-- Mensaje de Alerta (Solo para errores) -->
            <div id="alertContainer" class="alert-transition alert-closed">
                <!-- Contenido del mensaje de error se inyecta aquí -->
            </div>

            <!-- Nombre Completo -->
            <div>
                <label for="name" class="block text-sm font-medium text-gray-300">Nombre completo *</label>
                <input type="text" id="name" name="Nombre completo" required
                    class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-primary-dynamic focus:border-primary-dynamic">
            </div>

            <!-- Email (CRUCIAL: usa '_replyto' para Formspree) -->
            <div>
                <label for="email" class="block text-sm font-medium text-gray-300">Email *</label>
                <input type="email" id="email" name="_replyto" required 
                    placeholder="tu_correo@dominio.com"
                    class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-primary-dynamic focus:border-primary-dynamic">
            </div>

            <!-- Tipo de Proyecto -->
            <div>
                <label for="project_type" class="block text-sm font-medium text-gray-300">¿En qué puedo ayudarte? *</label>
                <select id="project_type" name="Tipo de Proyecto" required
                        class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-primary-dynamic focus:border-primary-dynamic appearance-none">
                    <option value="">Selecciona una opción</option>
                    <option value="Desarrollo Web (Landing Page)">Desarrollo Web (Landing Page)</option>
                    <option value="Desarrollo Web (E-commerce)">Desarrollo Web (E-commerce)</option>
                    <option value="Integración API/Backend">Integración API/Backend</option>
                    <option value="Entrevista, para trabajar en tu empresa">Entrevista, para trabajar en tu empresa</option>
                    <option value="Otro">Otro</option>
                </select>
            </div>

            <!-- Detalles del Proyecto -->
            <div>
                <label for="project_details" class="block text-sm font-medium text-gray-300">Cuéntame más detalles sobre lo que necesitas:</label>
                <textarea id="project_details" name="Detalles del Proyecto" rows="4" 
                        class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:ring-primary-dynamic focus:border-primary-dynamic"></textarea>
            </div>

            <!-- Presupuesto Estimado -->
            <div>
                <label for="budget" class="block text-sm font-medium text-gray-300">Presupuesto estimado (Opcional)</label>
                <select id="budget" name="Presupuesto Estimado"
                        class="mt-1 block w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-primary-dynamic focus:border-primary-dynamic appearance-none">
                    <option value="No especificado">Selecciona un rango</option>
                    <option value="Menos de 1000€">Menos de 1000€</option>
                    <option value="1000€ - 3000€">1000€ - 3000€</option>
                    <option value="3000€ - 6000€">3000€ - 6000€</option>
                    <option value="Más de 6000€">Más de 6000€</option>
                </select>
            </div>

            <!-- Botón de Envío -->
            <button type="submit" id="submitButton"
                    class="w-full py-3 bg-primary-dynamic text-gray-900 font-bold rounded-lg shadow-lg hover:bg-primary-dark-dynamic focus:outline-none focus:ring-4 focus:ring-primary-dynamic transition duration-150 ease-in-out">
                Enviar Solicitud
            </button>
            
            <!-- Campo Honeypot Oculto (Anti-spam de Formspree) -->
            <input type="text" name="_gotcha" style="display:none" />
        </form>
    </div>


    <!-- --------------------------------------- -->
    <!-- 3. Mensaje de Éxito (Oculto por defecto) -->
    <!-- --------------------------------------- -->
    <div id="successMessage" class="hidden text-center py-10 md:py-16">
        <!-- Icono de Check Grande (usando SVG) -->
        <svg class="w-20 h-20 mx-auto text-green-500 mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>

        <h2 class="text-3xl font-bold text-white mb-3">¡Mensaje Enviado con Éxito!</h2>
        <p class="text-gray-400 text-lg mb-8">
            Gracias por ponerte en contacto. Revisaré tu solicitud lo antes posible y te responderé directamente al correo electrónico que proporcionaste.
        </p>
        
        <!-- Botón para volver o recargar. Usa el color 'accent' (Azul) para contraste -->
        <button onclick="window.location.reload();"
                class="py-2 px-6 bg-accent text-white font-semibold rounded-lg shadow-lg hover:bg-blue-700 transition duration-150 ease-in-out">
            Volver al Formulario
        </button>
    </div>
    
    <p class="text-center text-sm text-gray-500 mt-4">
        Volver al <a href="#" class="text-primary-dynamic hover:text-primary-dark-dynamic">Portafolio Principal</a>
    </p>
</div>

<script>
    // ----------------------------------------------------
    // Lógica JavaScript para el manejo del formulario y colores
    // ----------------------------------------------------
    
    // *** ¡IMPORTANTE! DEBES REEMPLAZAR ESTA URL CON TU ENDPOINT REAL DE FORMSPREE ***
    const FORMSPREE_ENDPOINT = 'https://formspree.io/f/xnnwvdkl'; 
    // **********************************************************************

    const root = document.documentElement;
    const formContainer = document.getElementById('contactFormContainer');
    const successMessage = document.getElementById('successMessage');
    const form = document.getElementById('contactForm');
    const button = document.getElementById('submitButton');
    const colorPicker = document.getElementById('colorPicker');
    
    // ----------------------------------------------------
    // 1. GESTIÓN DE COLORES
    // ----------------------------------------------------

    /**
     * Aplica el color seleccionado a las variables CSS y lo guarda en localStorage.
     * @param {string} key - La clave de la paleta (ej. 'cyan').
     */
    function applyColor(key) {
        const palette = COLOR_PALETTES[key];
        if (!palette) return;

        primaryColor = palette.primary;
        darkColor = palette.dark;
        
        // Aplicar a las variables CSS
        root.style.setProperty('--color-primary', primaryColor);
        root.style.setProperty('--color-primary-dark', darkColor);

        // Guardar la clave en localStorage
        localStorage.setItem('themeColor', key);
        
        updateColorPicker(key);
    }
    
    /**
     * Dibuja los círculos de selección de color y asigna eventos.
     */
    function setupColorPicker() {
        let pickerHTML = '';
        for (const key in COLOR_PALETTES) {
            const color = COLOR_PALETTES[key].primary;
            pickerHTML += `
                <div class="color-circle" 
                     data-color-key="${key}" 
                     style="background-color: ${color};"
                     title="Cambiar a ${key}">
                </div>
            `;
        }
        colorPicker.innerHTML = pickerHTML;

        // Asignar el evento click
        colorPicker.querySelectorAll('.color-circle').forEach(circle => {
            circle.addEventListener('click', (e) => {
                applyColor(e.target.dataset.colorKey);
            });
        });
    }

    /**
     * Marca el círculo seleccionado.
     * @param {string} selectedKey - La clave de la paleta seleccionada.
     */
    function updateColorPicker(selectedKey) {
        colorPicker.querySelectorAll('.color-circle').forEach(circle => {
            circle.classList.remove('selected');
            if (circle.dataset.colorKey === selectedKey) {
                circle.classList.add('selected');
            }
        });
    }


    // ----------------------------------------------------
    // 2. GESTIÓN DEL FORMULARIO
    // ----------------------------------------------------
    
    function showForm() {
        formContainer.classList.remove('hidden');
        successMessage.classList.add('hidden');
    }
    
    /**
     * Muestra el mensaje de éxito y oculta el formulario.
     */
    function showSuccess() {
        formContainer.classList.add('hidden');
        successMessage.classList.remove('hidden');
        hideAlert(); // Asegurar que la alerta de error esté oculta
    }

    form.addEventListener('submit', async function(event) {
        event.preventDefault(); // ¡CRUCIAL! Previene el envío por defecto.

        const formData = new FormData(form);

        hideAlert(); 

        // Mostrar estado de carga y cambiar estilo del botón
        button.disabled = true;
        button.textContent = 'Enviando...';
        button.classList.remove('bg-primary-dynamic', 'hover:bg-primary-dark-dynamic');
        button.classList.add('bg-gray-500');

        try {
            const response = await fetch(FORMSPREE_ENDPOINT, {
                method: 'POST', 
                body: formData,
                headers: {
                    'Accept': 'application/json' 
                }
            });

            if (response.ok) {
                showSuccess();
                form.reset(); 

            } else {
                let message = 'Hubo un error al enviar. **Es probable que la URL de Formspree sea incorrecta (Error 405 o 404).**';
                
                if (response.status === 404) {
                     message = 'Error 404: Formulario no encontrado. Revisa la URL de Formspree.';
                } else if (response.status === 405) {
                     message = 'Error 405: Método no permitido. **¡Revisa la constante FORMSPREE_ENDPOINT!**';
                } else if (response.status === 422) {
                    message = 'Error 422: Datos no válidos. Asegúrate de rellenar todos los campos requeridos.';
                } else {
                    try {
                        const errorData = await response.json();
                        message = errorData.error || message;
                    } catch (e) {
                        message = `Error de Formspree (código: ${response.status}). Inténtalo de nuevo.`;
                    }
                }
                showAlert(message, 'error');
            }

        } catch (error) {
            console.error('Error de conexión o fetch:', error);
            showAlert('Error de conexión. Revisa tu red o inténtalo de nuevo.', 'error');
        } finally {
            // Restablecer el botón solo si NO fue un éxito
            if (successMessage.classList.contains('hidden')) {
                button.disabled = false;
                button.textContent = 'Enviar Solicitud';
                button.classList.remove('bg-gray-500');
                button.classList.add('bg-primary-dynamic', 'hover:bg-primary-dark-dynamic');
            }
        }
    });

    /**
     * Muestra una alerta de error.
     */
    function showAlert(message) {
        const alertContainer = document.getElementById('alertContainer');
        const bgColor = 'bg-red-600';
        const iconSvg = '<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />';

        const alertHTML = `
            <div class="${bgColor} text-white p-4 rounded-lg flex items-center shadow-md">
                <svg class="w-5 h-5 mr-3 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    ${iconSvg}
                </svg>
                <p class="text-sm font-medium">${message}</p>
            </div>
        `;
        
        alertContainer.innerHTML = alertHTML;
        alertContainer.classList.remove('alert-closed');
        alertContainer.classList.add('alert-open');
    }

    /**
     * Oculta el contenedor de alerta.
     */
    function hideAlert() {
        const alertContainer = document.getElementById('alertContainer');
        
        alertContainer.classList.remove('alert-open');
        alertContainer.classList.add('alert-closed');

        setTimeout(() => {
            alertContainer.innerHTML = '';
        }, 300); 
    }

    // ----------------------------------------------------
    // INICIALIZACIÓN
    // ----------------------------------------------------
    window.onload = function() {
        // 1. Cargar el color guardado o usar el cian por defecto
        const savedColorKey = localStorage.getItem('themeColor') || 'cyan';
        
        // 2. Configurar y aplicar el color
        setupColorPicker();
        applyColor(savedColorKey); 

        // 3. Mostrar el formulario
        showForm();
        hideAlert();
    }
</script>
